<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>java实例化一个类时栈和堆中发生了什么 | frozeNwInd</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">java实例化一个类时栈和堆中发生了什么</h1><a id="logo" href="/.">frozeNwInd</a><p class="description">吕成锋的博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/history/"><i class="fa fa-history"> 由来</i></a><a href="/aboutHer/"><i class="fa fa-heart"> aboutSHZ</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">java实例化一个类时栈和堆中发生了什么</h1><div class="post-meta">Mar 30, 2019<span> | </span><span class="category"><a href="/categories/technology/">technology</a></span></div><a class="disqus-comment-count" href="/2019/03/30/java实例化一个类时栈和堆中发生了什么/#vcomment"><span class="valine-comment-count" data-xid="/2019/03/30/java实例化一个类时栈和堆中发生了什么/"></span><span> 条评论</span></a><div class="post-content"><p>首先说一下关于引用类型变量的声明和使用<br>&emsp;&emsp;（1）把类名当作是一种类型来声明变量，这种变量叫引用类型变量。如：A a;<br>&emsp;&emsp;（2）引用类型变量保存对象的“引用”，即对象的地址。（对象是类的实例化）<br>&emsp;&emsp;（3）对象的创建 new 类名(),如：new A();<br>&emsp;&emsp;（4）new创建对象后返回对象的引用，对象没有名字，只能通过使用对象的引用间接使用对象，引用类型变量就是专门用来保存对象引用的，也就是保存对象的地址，是对象在堆内存中的地址。如：A a = new A();<br>&emsp;&emsp;（5）成员变量的默认值：数据类型成员变量(byte、short、int、long)默认值为0，字符型(char)的默认值是/u0000(unicode编码集编号为0的字符)，浮点型(double、float)默认值为0.0，boolean型成员变量默认值为false，引用类型成员变量默认值为null。<br>&emsp;&emsp;（6）对象内存分配。对象是被保存在堆中的，对象没有名字。对象中保存的是对象的成员变量，（成员变量定义在类中，方法体之外，是对象的特有属性，只能被对象调用，存储在堆内存的对象中）。没有引用类型变量保存对象的引用时，没有栈中的变量指向堆中的对象，对象被认为是垃圾，会被jvm的垃圾回收机制销毁。<br>&emsp;&emsp;（7）使用对象的引用来访问对象的成员变量和成员方法，都是使用“.”，成员变量和成员方法统称为成员。<br>创建对象后直接访问成员，随之对象就会被销毁，这种对象称之为匿名对象，如：new People().name=”老王”;<br>创建对象后返回的引用被引用类型变量保存（对象在堆内存中的地址被引用类型变量保存），使用“引用类型变量.成员”，如：PeoPle laoWang=new People(); laoWang.name=”老王”;</p>
<p>JAVA中的堆和栈<br>&emsp;&emsp;java把内存划分成两种：一种是栈内存，一种是堆内存。<br>&emsp;&emsp;在函数中定义的一些基本类型的变量和对象的引用变量都在栈内存中分配。<br>&emsp;&emsp;当在一段代码块定义一个变量时，java就在栈中为这个变量分配内存空间，当超过变量的作用域后，java会自动释放掉为该变量所分配的内存空间，该内存空间可以立即被另作他用。<br>&emsp;&emsp;堆内存用来存放由new创建的对象和数组。<br>&emsp;&emsp;在堆中分配的内存，由java虚拟机的自动垃圾回收器来管理。<br>&emsp;&emsp;在堆中产生一个数组或对象后，栈中有一个与之相对应的变量，这个变量的取值等于数组或对象在堆内存中的首地址，栈中的这个变量就是数组或对象的引用变量。栈中的引用变量指向堆内存中的数组或对象（其实就是C语言中的指针，只不过java中没有指针。）。<br>&emsp;&emsp;引用变量就是为数组或对象起的一个名称，以后就可以在程序中使用栈中的引用变量来访问堆中的数组或对象。<br>&emsp;&emsp;引用变量定义时在栈中分配内存，在程序运行到作用域外释放。而数组&amp;对象本身在堆中分配内存，即使程序运行到使用new产生数组和对象的语句所在的代码块之外，数组和对象本身占用的堆内存也不会被释放，数组和对象只有在没有引用变量指向它的时候，才变成垃圾，不能在被使用，但是仍然占用着内存，在随后的一个不确定的时间被jvm的垃圾回收机制——垃圾回收器释放掉。</p>
<p>实例化对象过程<br>在下面的这段代码中，java实例化一个类时在堆和栈中保存了那些数据。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mian</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    A a=<span class="keyword">new</span> A();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/30/java实例化一个类时栈和堆中发生了什么/1.jpg" alt="如图示"><br>1.加载class文件到class内容区域，加载静态方法和静态变量到静态区（同时加载）。<br>2.调用main方法到栈内存。<br>3.在栈内存中为a变量（A对象的引用）开辟空间。<br>4.在堆内存为A对象申请空间。<br>5.给成员变量进行默认初始化（此时 i=0），同时有一个方法标记，在方法区中创建一个A的方法区，将A的方法区的地址0x01给方法标记 ？？？<br>6.给成员变量进行显示初始化（此时 i=1）？？？<br>7.将A对象的地址值给变量a，栈中的a保存的是对象A的地址。<br>所以A a=new A();栈中保存了A对象的引用，即变量a，堆中保存了A对象。</p>
<p>栈、堆、方法区<br>1.栈（stack）<br>每个线程包含一个栈区，栈中只保存基础数据类型（byte、short、int、long、float、double、boolean、char）的对象和自定义对象的引用。每个栈中的数据（原始类型和对象引用）都是私有的，其他栈不能访问。<br>2.堆（heap）<br>堆提供所有类实例（对象）和数组对象存储区域。jvm只有一个堆区（heap），被所有线程共享，堆中不存放基本类型和对象引用，只存放对象本身。<br>堆内存用来存放new创建的对象和数组，即动态申请的内存都存放在堆内存。<br>3.方法区<br>又叫静态区，跟堆一样，被所有线程共享。方法区包含所有的class（成员变量）和static（静态变量，又叫类变量，由static修饰）变量。方法区中包含的是在整个程序中永远唯一的元素。运行时常量池都分配的jvm的方法区之中。</p>
</div><div class="tags"><a href="/tags/java基础/">java基础</a></div><div class="post-nav"><a class="pre" href="/2019/03/30/数据结构—排序总结/">数据结构—排序总结</a><a class="next" href="/2019/03/27/关于控制反转和依赖注入的理解/">关于控制反转和依赖注入的理解</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'6Cf3b4KjUDTblsuWBz4jJcdU-gzGzoHsz',
  appKey:'l6wP9udo8YARTJrXperWuWgE',
  placeholder:'我想听你说一句… （留言请填写您的昵称和邮箱，方便回复以邮件形式通知您）',
  avatar:'retro',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"><input type="hidden" name="si" value="https://th3crave.github.io"><input name="tn" type="hidden" value="bds"><input name="cl" type="hidden" value="3"><input name="ct" type="hidden" value="2097152"><input name="s" type="hidden" value="on"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/emotion/">emotion</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">technology</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/java基础/" style="font-size: 15px;">java基础</a> <a href="/tags/java-web/" style="font-size: 15px;">java web</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/情书/" style="font-size: 15px;">情书</a> <a href="/tags/一言/" style="font-size: 15px;">一言</a> <a href="/tags/词/" style="font-size: 15px;">词</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/04/Blue-Butterfly/">Blue Butterfly</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/03/落寞诗人/">落寞诗人</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/31/doGet和doPost/">doGet和doPost</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/30/听我·一言/">听我·一言</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/30/数据结构—排序总结/">数据结构—排序总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/30/java实例化一个类时栈和堆中发生了什么/">java实例化一个类时栈和堆中发生了什么</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/27/关于控制反转和依赖注入的理解/">关于控制反转和依赖注入的理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/24/和小北说的999句话/">和小北说的999句话</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/23/maven整合ssm框架中的问题/">maven整合ssm框架中的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/23/关于java中float和double的一些问题/">关于java中float和double的一些问题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.scarboroughcoral.top/" title="scarboroughcoral" target="_blank">scarboroughcoral</a><ul></ul><a target="_blank"></a><ul></ul><a target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">frozeNwInd.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" color="100,99,98" opacity="0.7" zindex="-1" count="150" src="//lib.baomitu.com/canvas-nest.js/2.0.3/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>